'use strict';var x=require('concaveman');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var x__default=/*#__PURE__*/_interopDefault(x);function g(o,e){let t=o.x-e.x,r=o.y-e.y;return t*t+r*r}function c(o,e=3){let t=10**e;return (Math.round(o*t)/t).toString()}var a=class o{static concavity=1;static lengthThreshold=10;color;sampledPoints;hullPoints;constructor(e,t,r){this.color=e,this.sampledPoints=t;let n=t.map(i=>[i.x,i.y]);this.hullPoints=this.reducePoints(x__default.default(n,o.concavity,1).map(([i,s])=>({x:i,y:s})),r);}reducePoints(e,t){let r=t*t,n=[];for(let i of e)(n.length===0||g(i,n[n.length-1])>=r)&&n.push(i);return n.length>1&&g(n[0],n[n.length-1])<r&&n.pop(),n}};function f(o,e,t,r,n){let i=b(o,t);return V(i)}function V(o,e={}){let{isClosed:t=true,alpha:r=.5}=e;if(o.length<2)return "";let n=C(o,t),i=`M ${c(o[0].x)} ${c(o[0].y)}`;for(let s=1;s<n.length-2;s++){let[h,l,u,m]=S(n[s-1],n[s],n[s+1],n[s+2],r);i+=` C ${c(h)} ${c(l)}, ${c(u)} ${c(m)}, ${c(n[s+1].x)} ${c(n[s+1].y)}`;}return t?`${i} Z`:i}function b(o,e,t){let r=o;for(let n=0;n<e;n++)r=P(r);return r}function P(o,e){let t=[],r=o.length;let n=r;for(let i=0;i<n-1;i++){let[s,h]=p(o[i],o[i+1]);t.push(s,h);}{let[i,s]=p(o[r-1],o[0]);t.push(i,s);}return t}function S(o,e,t,r,n){let i=n*(t.x-o.x),s=n*(t.y-o.y),h=n*(r.x-e.x),l=n*(r.y-e.y);return [e.x+i/3,e.y+s/3,t.x-h/3,t.y-l/3]}function p(o,e){return [{x:.75*o.x+.25*e.x,y:.75*o.y+.25*e.y},{x:.25*o.x+.75*e.x,y:.25*o.y+.75*e.y}]}function C(o,e){let t=o.slice();return e?(t.unshift(o[o.length-1]),t.push(o[0],o[1])):(t.unshift(o[0]),t.push(o[o.length-1])),t}var y=class{width;height;smoothingMinLength;chaikinSmoothingSteps;pixelGridStepSize;hulls;debugPointRadius;constructor(e,t,r){if(!e)throw new Error("imageData is required");if(!t?.length)throw new Error("palette must contain at least one color");let{smoothingMinLength:n,chaikinSmoothingSteps:i,pixelGridStepSize:s=1,debugPointRadius:h}=r;this.width=e.width,this.height=e.height,this.smoothingMinLength=n,this.chaikinSmoothingSteps=i,this.pixelGridStepSize=Math.max(1,Math.floor(s)),this.debugPointRadius=h,this.hulls=this.createHullsFromPalette(e,t);}getHullByColor(e){return this.hulls.find(t=>this.colorsMatch(t.color,e))}getSVGString(){let e=[`<svg width="${this.width}" height="${this.height}" `,'version="1.1" xmlns="http://www.w3.org/2000/svg" ',`desc="Created with VectorCraft">
`];for(let t of this.hulls)e.push(this.createPathElement(t.hullPoints,t.color)),this.debugPointRadius!==void 0&&e.push(this.createPointElements(t.hullPoints));return e.push("</svg>"),e.join("")}createHullsFromPalette(e,t){return t.map(r=>this.createHullForColor(e,r))}createHullForColor(e,t){let r=this.createMaskPointCloud(e,t);return new a(t,r,this.smoothingMinLength)}createMaskPointCloud(e,t){let{data:r,width:n,height:i}=e,s=[],h=this.pixelGridStepSize;for(let l=0;l<i;l+=h)for(let u=0;u<n;u+=h){let m=(l*n+u)*4;this.pixelMatches(r,m,t)&&s.push({x:u,y:l});}return s}createPathElement(e,t){let{r,g:n,b:i}=t,s=f(e,this.smoothingMinLength,this.chaikinSmoothingSteps,this.width,this.height);return `<path fill="rgb(${r},${n},${i})" d="${s}" />
`}createPointElements(e){return e.map(t=>`<circle cx="${c(t.x)}" cy="${c(t.y)}" r="${this.debugPointRadius}" fill="#000" stroke="none" />
`).join("")}pixelMatches(e,t,r){return e[t+3]!==0&&e[t]===r.r&&e[t+1]===r.g&&e[t+2]===r.b}colorsMatch(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b}};function d(o,e,t){return (e.x-o.x)*(t.y-o.y)-(e.y-o.y)*(t.x-o.x)}function w(o,e){return o.x===e.x&&o.y===e.y}function z(o){if(o.length<=1)return o.slice();let e=o.sort((i,s)=>i.x===s.x?i.y-s.y:i.x-s.x),t=[];for(let i of e)(!t.length||!w(t[t.length-1],i))&&t.push(i);if(t.length<=1)return t.slice();let r=[];for(let i of t){for(;r.length>=2&&d(r[r.length-2],r[r.length-1],i)<=0;)r.pop();r.push(i);}let n=[];for(let i=t.length-1;i>=0;i--){let s=t[i];for(;n.length>=2&&d(n[n.length-2],n[n.length-1],s)<=0;)n.pop();n.push(s);}return r.pop(),n.pop(),r.concat(n)}exports.Hull=a;exports.ImageTrace=y;exports.createConvexHullPoints=z;//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map